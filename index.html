<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>일본어 학습 도우미</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
        }
        .tab-btn.active {
            border-color: #3b82f6;
            color: #3b82f6;
            background-color: #eff6ff;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .hiragana-grid-container {
            display: grid;
            grid-template-columns: repeat(5, minmax(0, 1fr));
            gap: 0.5rem;
            text-align: center;
        }
        .yoon-grid-container {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 0.5rem;
            text-align: center;
        }
        .quiz-option.correct {
            background-color: #22c55e; /* green-500 */
            color: white;
            border-color: #16a34a; /* green-600 */
        }
        .quiz-option.incorrect {
            background-color: #ef4444; /* red-500 */
            color: white;
            border-color: #dc2626; /* red-600 */
        }
        .quiz-option:disabled {
            opacity: 0.8;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-blue-600">일본어 학습 도우미</h1>
            <p class="mt-2 text-lg text-gray-600">이미지와 필기 속 단어, 문장, 문화 정보를 정리했어요.</p>
        </header>

        <!-- Tab Navigation -->
        <div class="mb-6 border-b border-gray-200">
            <nav class="flex flex-wrap -mb-px" aria-label="Tabs">
                <button onclick="changeTab('vocab')" class="tab-btn active text-lg font-semibold border-b-2 border-transparent px-4 py-3 transition-colors duration-200 ease-in-out">
                    📚 단어장
                </button>
                <button onclick="changeTab('phrases')" class="tab-btn text-lg font-semibold border-b-2 border-transparent px-4 py-3 transition-colors duration-200 ease-in-out">
                    💬 표현과 규칙
                </button>
                <button onclick="changeTab('hiragana')" class="tab-btn text-lg font-semibold border-b-2 border-transparent px-4 py-3 transition-colors duration-200 ease-in-out">
                    📝 히라가나 표
                </button>
                <button onclick="changeTab('map')" class="tab-btn text-lg font-semibold border-b-2 border-transparent px-4 py-3 transition-colors duration-200 ease-in-out">
                    🗺️ 일본 문화 지도
                </button>
                <button onclick="changeTab('numbers')" class="tab-btn text-lg font-semibold border-b-2 border-transparent px-4 py-3 transition-colors duration-200 ease-in-out">
                    🔢 숫자
                </button>
                <button onclick="changeTab('test')" class="tab-btn text-lg font-semibold border-b-2 border-transparent px-4 py-3 transition-colors duration-200 ease-in-out">
                    ✅ 학습 테스트
                </button>
            </nav>
        </div>

        <!-- Tab Content -->
        <main>
            <!-- Vocabulary Section -->
            <div id="vocab" class="tab-content active">
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                    <!-- Words will be dynamically inserted here -->
                </div>
            </div>

            <!-- Phrases & Culture Section -->
            <div id="phrases" class="tab-content">
                 <div class="space-y-8">
                    <div>
                        <h3 class="text-2xl font-bold text-blue-600 mb-4 border-b pb-2">👋 인사말</h3>
                        <div id="phrases-greetings" class="space-y-4">
                            <!-- Phrases will be dynamically inserted here -->
                        </div>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold text-blue-600 mb-4 border-b pb-2">🗣️ 호칭과 1인칭 대명사</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white p-5 rounded-lg shadow-md">
                                <h4 class="text-xl font-semibold mb-3 text-blue-500">나를 가리키는 말</h4>
                                <ul class="space-y-3 text-gray-700">
                                    <li><strong>わたし (私):</strong> 가장 일반적이고 공손한 표현 (남녀공용)</li>
                                    <li><strong>わたくし (私):</strong> 'わたし'보다 더 격식있고 겸손한 표현</li>
                                    <li><strong>ぼく (僕):</strong> 주로 남성이 사용하는 부드러운 표현</li>
                                    <li><strong>おれ (俺):</strong> 매우 친한 사이에서 남성이 사용하는 표현</li>
                                </ul>
                            </div>
                            <div class="bg-white p-5 rounded-lg shadow-md">
                                <h4 class="text-xl font-semibold mb-3 text-blue-500">상대방을 부르는 말</h4>
                                <ul class="space-y-3 text-gray-700">
                                    <li><strong>さま (様):</strong> 가장 높임 표현 (고객, 신 등)</li>
                                    <li><strong>さん:</strong> 가장 일반적으로 쓰이는 존칭 (Mr./Ms.)</li>
                                    <li><strong>くん (君):</strong> 주로 남자 후배나 동년배에게 사용</li>
                                    <li><strong>ちゃん:</strong> 주로 여자 아이나 친한 친구에게 사용</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pronunciation Rules Section from Notes -->
                    <div>
                        <h3 class="text-2xl font-bold text-blue-600 mb-4 border-b pb-2">✍️ 일본어 발음 규칙</h3>
                        <div class="space-y-6">
                            <div class="bg-white p-5 rounded-lg shadow-md space-y-4">
                                <h4 class="text-xl font-semibold text-blue-500">촉음(促音), 장음(長音), 발음(撥音)</h4>
                                <ul class="list-disc list-inside space-y-2">
                                    <li><strong>촉음(促音):</strong> 작은 'つ' (っ)는 뒤에 오는 자음을 한 번 더 발음하는 받침처럼 쓰여요. 예: きって (킷테), げっせき (겟세키)</li>
                                    <li><strong>장음(長音):</strong> 모음을 길게 발음하는 규칙이에요. 예를 들어 'おかあさん'(오카-상)처럼 '아' 단 뒤의 'あ'는 앞의 '아'를 길게 발음해줘요.</li>
                                    <li><strong>발음(撥音):</strong> 'ん'은 뒤에 오는 소리에 따라 'ㄴ', 'ㅁ', 'ㅇ' 받침 소리를 내요. 예: さんぽ (산뽀), でんわ (뎅와)</li>
                                </ul>
                            </div>
                             <div class="bg-white p-5 rounded-lg shadow-md space-y-4">
                                <h4 class="text-xl font-semibold text-blue-500">연탁 현상(連濁)</h4>
                                <p>두 개의 단어가 합쳐져 하나의 단어가 될 때, 뒤에 오는 단어의 첫소리가 탁음으로 바뀌는 현상이에요. 모든 단어에 적용되는 것은 아니지만 알아두면 유용해요.</p>
                                <ul class="list-disc list-inside space-y-2">
                                    <li>예시: かいてん(회전) + すし(초밥) → かいてん<strong class="text-red-500">ず</strong>し (카이텐즈시)</li>
                                    <li>예시: て(손) + かみ(종이) → て<strong class="text-red-500">が</strong>み (테가미)</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-2xl font-bold text-blue-600 mb-4 border-b pb-2">💡 알아두면 좋은 일본어 지식</h3>
                        <div class="bg-white p-5 rounded-lg shadow-md space-y-4 text-gray-700">
                             <div>
                                <h4 class="text-xl font-semibold mb-2 text-blue-500">조사 'は'와 'へ'의 발음</h4>
                                <p>조사로 쓰일 때 일부 히라가나는 발음이 달라져요.</p>
                                <ul class="list-disc list-inside space-y-2">
                                    <li>조사 'は'는 '와(wa)'로 발음돼요. 예: わたしは (와타시와)</li>
                                    <li>조사 'へ'는 '에(e)'로 발음돼요. 예: がっこうへ (각코ー에)</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="text-xl font-semibold mb-2 text-blue-500">인사말의 유래</h4>
                                <p>'こんにちは'나 'こんばんは' 같은 인사말은 원래 '今日はご機嫌いかがですか' (오늘 기분은 어떠신가요?)와 같은 문장의 뒷부분이 생략되면서 굳어진 표현이에요. 그래서 문장 중간에 쓰이던 조사 'は'가 그대로 남아있답니다.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Materials from Uploaded Notes -->
                    <div>
                        <h3 class="text-2xl font-bold text-blue-600 mb-4 border-b pb-2">📝 추가 학습 자료 (기본 문장과 직업)</h3>
                        <div class="space-y-6">
                            <div class="bg-white p-5 rounded-lg shadow-md space-y-4">
                                <h4 class="text-xl font-semibold text-blue-500">추가 단어</h4>
                                <ul class="list-disc list-inside space-y-2">
                                    <li><strong>先生 (せんせい, sensei):</strong> 선생님</li>
                                    <li><strong>学生 (がくせい, gakusei):</strong> 학생</li>
                                    <li><strong>医生 (いしゃ, isha):</strong> 의사</li>
                                </ul>
                            </div>
                            <div class="bg-white p-5 rounded-lg shadow-md space-y-4">
                                <h4 class="text-xl font-semibold text-blue-500">기본 문장 예시</h4>
                                <ul class="space-y-3 text-gray-700">
                                    <li><strong>いさんは 学生です。</strong> (이さんは 학생입니다.) - I-san is a student.</li>
                                    <li><strong>いさんは 学生ですか。</strong> (이さんは 학생입니까?) - Is I-san a student?</li>
                                    <li><strong>はい、 いさんは 学生です。</strong> (네, 이さんは 학생입니다.)</li>
                                    <li><strong>パクさんは 医生です。</strong> (박さんは 의사입니다.) - Park-san is a doctor.</li>
                                    <li><strong>パクさんは 医生ですか。</strong> (박さんは 의사입니까?) - Is Park-san a doctor?</li>
                                    <li><strong>はい、 パクさんは 医生です。</strong> (네, 박さんは 의사입니다.)</li>
                                    <li><strong>いさんは 先生です。</strong> (이さんは 선생님입니다.) - I-san is a teacher.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hiragana Chart Section -->
            <div id="hiragana" class="tab-content">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-2xl font-bold text-blue-600 mb-4 border-b pb-2">五十音図 (ごじゅうおんず) - 오십음도</h3>
                    <div id="hiragana-grid" class="hiragana-grid-container">
                        <!-- Hiragana characters will be dynamically inserted here -->
                    </div>
                    
                    <h3 class="text-2xl font-bold text-blue-600 mt-10 mb-4 border-b pb-2">탁음(濁音)과 반탁음(半濁音)</h3>
                    <div id="dakuon-grid" class="space-y-4">
                         <!-- Dakuon/Handakuon charts will be dynamically inserted here -->
                    </div>

                    <h3 class="text-2xl font-bold text-blue-600 mt-10 mb-4 border-b pb-2">拗音 (ようおん) - 요음</h3>
                    <div id="yoon-grid" class="space-y-4">
                        <!-- Yoon charts will be dynamically inserted here -->
                    </div>
                </div>
            </div>

            <!-- Map & Culture Section -->
            <div id="map" class="tab-content">
                 <div class="bg-white p-6 rounded-lg shadow-md space-y-8">
                    <div>
                        <h3 class="text-2xl font-bold text-blue-600 mb-4 border-b pb-2">🗾 일본 기본 정보</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-lg">
                            <p><strong>국토:</strong> 홋카이도(北海道), 혼슈(本州), 시코쿠(四国), 규슈(九州) 4개의 큰 섬과 약 6,800여 개의 작은 섬으로 이루어져 있어요. (한반도의 약 1.7배)</p>
                            <p><strong>인구:</strong> 약 1억 2,500만 명 이상으로, 세계 12위의 인구 대국이에요.</p>
                            <p><strong>행정구역:</strong> 1도(都), 1도(道), 2부(府), 43현(県)으로 구성돼요. (총 47개 도도부현)</p>
                             <p><strong>기후:</strong> 남북으로 길게 뻗어 있어 지역별로 차이가 있지만, 대부분 사계절이 뚜렷한 온대 기후에 속해요.</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <h4 class="text-xl font-semibold mb-3 text-blue-500">📍 주요 지역 및 명소</h4>
                            <ul class="space-y-2 text-gray-700" id="map-locations">
                                <!-- Locations will be dynamically inserted -->
                            </ul>
                        </div>
                        <div class="space-y-6">
                            <div>
                                <h4 class="text-xl font-semibold mb-3 text-blue-500">💴 일본의 화폐와 소비세</h4>
                                <p>통화 단위는 <strong>엔(円)</strong>입니다. 동전은 1, 5, 10, 50, 100, 500엔, 지폐는 1000, 2000, 5000, 10000엔이 사용됩니다.</p>
                                <p class="mt-2">물건을 살 때는 가격에 <strong>소비세(消費税) 10%</strong>가 추가돼요.</p>
                            </div>
                            <div>
                                <h4 class="text-xl font-semibold mb-3 text-blue-500">✍️ 일본의 문자</h4>
                                <p>일본어는 <strong>히라가나, 가타카나, 한자</strong> 세 종류의 문자를 함께 사용합니다. 각각의 모양과 쓰임새가 다릅니다.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Numbers Section -->
            <div id="numbers" class="tab-content">
                <div class="bg-white p-6 rounded-lg shadow-md space-y-8">
                    <h3 class="text-2xl font-bold text-blue-600 mb-4 border-b pb-2">🔢 일본어 숫자 (1~100 예시)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <h4 class="text-xl font-semibold text-blue-500">기본 숫자 (1~10)</h4>
                            <ul class="space-y-2 text-gray-700">
                                <li><strong>1: いち (이찌)</strong></li>
                                <li><strong>2: に (니)</strong></li>
                                <li><strong>3: さん (상)</strong></li>
                                <li><strong>4: し / よん (시 / 용)</strong></li>
                                <li><strong>5: ご (고)</strong></li>
                                <li><strong>6: ろく (로꾸)</strong></li>
                                <li><strong>7: しち / なな (시찌 / 나나)</strong></li>
                                <li><strong>8: はち (하찌)</strong></li>
                                <li><strong>9: く / きゅう (쿠 / 큐-)</strong></li>
                                <li><strong>10: じゅう (쥬-)</strong></li>
                            </ul>
                        </div>
                        <div class="space-y-4">
                            <h4 class="text-xl font-semibold text-blue-500">10의 배수 예시</h4>
                            <ul class="space-y-2 text-gray-700">
                                <li><strong>20: にじゅう (니쥬-)</strong></li>
                                <li><strong>30: さんじゅう (산쥬-)</strong></li>
                                <li><strong>40: よんじゅう (욘쥬-)</strong></li>
                                <li><strong>50: ごじゅう (고쥬-)</strong></li>
                                <li><strong>60: ろくじゅう (로꾸쥬-)</strong></li>
                                <li><strong>70: ななじゅう (나나쥬-)</strong></li>
                                <li><strong>80: はちじゅう (하찌쥬-)</strong></li>
                                <li><strong>90: きゅうじゅう (큐-쥬-)</strong></li>
                                <li><strong>100: ひゃく (햐꾸)</strong></li>
                            </ul>
                        </div>
                    </div>
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <h4 class="text-xl font-semibold mb-3 text-blue-500">숫자 변환기 (1~999)</h4>
                        <input type="number" id="number-input" min="1" max="999" placeholder="숫자 입력 (1~999)" class="w-full p-2 border rounded mb-2">
                        <button onclick="convertNumber()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded">변환</button>
                        <p id="number-result" class="mt-4 text-lg font-semibold"></p>
                    </div>
                </div>
            </div>

            <!-- Test Section -->
            <div id="test" class="tab-content">
                <div id="test-selection" class="text-center">
                    <h3 class="text-2xl font-bold text-blue-600 mb-6">학습한 내용을 테스트해 보세요!</h3>
                    <div class="flex flex-col sm:flex-row justify-center items-center gap-4">
                        <button onclick="startTest('hiragana')" class="w-full sm:w-auto bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 px-8 rounded-lg transition-transform transform hover:scale-105 shadow-lg">
                            히라가나 테스트
                        </button>
                        <button onclick="startTest('vocab')" class="w-full sm:w-auto bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-8 rounded-lg transition-transform transform hover:scale-105 shadow-lg">
                            단어 테스트
                        </button>
                        <button onclick="startTest('content')" class="w-full sm:w-auto bg-purple-500 hover:bg-purple-600 text-white font-bold py-4 px-8 rounded-lg transition-transform transform hover:scale-105 shadow-lg">
                            학습 내용 테스트
                        </button>
                    </div>
                </div>

                <div id="quiz-container" class="hidden w-full max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-md">
                    <div id="quiz-header" class="flex justify-between items-center mb-4">
                        <h3 id="quiz-title" class="text-xl font-bold text-blue-600"></h3>
                        <p id="quiz-progress" class="text-gray-600 font-semibold"></p>
                    </div>
                    <div id="quiz-question" class="text-center text-4xl font-bold my-8 min-h-[60px]"></div>
                    <div id="quiz-options" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
                    <div id="quiz-feedback" class="mt-4 text-center font-bold"></div>
                    <div class="mt-6 text-center">
                        <button id="next-question-btn" class="hidden bg-gray-700 hover:bg-gray-800 text-white font-bold py-2 px-6 rounded-lg">다음 문제</button>
                    </div>
                </div>

                <div id="result-container" class="hidden text-center w-full max-w-2xl mx-auto bg-white p-8 rounded-lg shadow-md">
                    <h3 class="text-3xl font-bold text-blue-600 mb-4">테스트 결과</h3>
                    <p id="result-score" class="text-5xl font-bold my-6"></p>
                    <p id="result-message" class="text-lg text-gray-700"></p>
                    <div class="mt-8 flex justify-center gap-4">
                        <button id="retry-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg">다시 풀기</button>
                        <button onclick="showTestSelection()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg">메뉴로 돌아가기</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Data from original file and user's notes
        const vocabulary = [
             // Original
            { jp: 'あかい', romaji: 'akai', kr: '빨갛다' }, { jp: 'いえ', romaji: 'ie', kr: '집' },
            { jp: 'えき', romaji: 'eki', kr: '역' }, { jp: 'かお', romaji: 'kao', kr: '얼굴' },
            { jp: 'いす', romaji: 'isu', kr: '의자' }, { jp: 'すし', romaji: 'sushi', kr: '초밥' },
            { jp: 'しち', romaji: 'shichi', kr: '일곱' }, { jp: 'つくえ', romaji: 'tsukue', kr: '책상' },
            { jp: 'ちかてつ', romaji: 'chikatetsu', kr: '지하철' }, { jp: 'いぬ', romaji: 'inu', kr: '개' },
            { jp: 'ねこ', romaji: 'neko', kr: '고양이' }, { jp: 'はち', romaji: 'hachi', kr: '여덟' },
            { jp: 'ひと', romaji: 'hito', kr: '사람' }, { jp: 'みせ', romaji: 'mise', kr: '가게' },
            { jp: 'なまえ', romaji: 'namae', kr: '이름' }, { jp: 'やさい', romaji: 'yasai', kr: '채소' },
            { jp: 'ふゆ', romaji: 'fuyu', kr: '겨울' }, { jp: 'ふろ', romaji: 'furo', kr: '목욕' },
            { jp: 'ろく', romaji: 'roku', kr: '여섯' }, { jp: 'くすり', romaji: 'kusuri', kr: '약' },
            { jp: 'にわ', romaji: 'niwa', kr: '정원' }, { jp: 'わたし', romaji: 'watashi', kr: '나, 저' },
            { jp: 'しろい', romaji: 'shiroi', kr: '하얗다' }, { jp: 'かぞく', romaji: 'kazoku', kr: '가족' },
            { jp: 'せんせい', romaji: 'sensei', kr: '선생님' }, { jp: 'すうがく', romaji: 'suugaku', kr: '수학' },
            { jp: 'がっこう', romaji: 'gakkou', kr: '학교' }, { jp: 'おんがく', romaji: 'ongaku', kr: '음악' },
            { jp: 'かばん', romaji: 'kaban', kr: '가방' }, { jp: 'さんぽ', romaji: 'sanpo', kr: '산책' },
            { jp: 'りょうり', romaji: 'ryouri', kr: '요리' }, { jp: 'ここ', romaji: 'koko', kr: '여기' },
            { jp: 'ほん', romaji: 'hon', kr: '책' }, { jp: 'よん', romaji: 'yon', kr: '사' },
            { jp: 'ぶかつ', romaji: 'bukatsu', kr: '동아리활동' }, { jp: 'ごご', romaji: 'gogo', kr: '오후' },
            { jp: 'あし', romaji: 'ashi', kr: '다리' }, { jp: 'あじ', romaji: 'aji', kr: '맛' },
            { jp: 'いしゃ', romaji: 'isha', kr: '의사' }, { jp: 'きゅう', romaji: 'kyuu', kr: '9' },
            { jp: 'じゆう', romaji: 'jiyū', kr: '자유' }, { jp: 'じゅう', romaji: 'juu', kr: '10' },
            { jp: 'りゅう', romaji: 'ryuu', kr: '용' }, { jp: 'わたしたち', romaji: 'watashitachi', kr: '우리들' },
            { jp: 'けさ', romaji: 'kesa', kr: '오늘 아침' }, { jp: 'いっぱい', romaji: 'ippai', kr: '가득' },
            { jp: 'きって', romaji: 'kitte', kr: '우표' }, { jp: 'せんぱい', romaji: 'senpai', kr: '선배' },
            { jp: 'ほっかいどう', romaji: 'hokkaido', kr: '홋카이도' }, { jp: 'おかあさん', romaji: 'okaasan', kr: '어머니' },
            { jp: 'おにいさん', romaji: 'oniisan', kr: '형, 오빠' }, { jp: 'おねえさん', romaji: 'oneesan', kr: '누나, 언니' },
            { jp: 'おおさか', romaji: 'oosaka', kr: '오사카' }, { jp: 'こうこう', romaji: 'koukou', kr: '고등학교' },
            { jp: 'おばさん', romaji: 'obasan', kr: '아주머니' }, { jp: 'おばあさん', romaji: 'obaasan', kr: '할머니' },
            { jp: 'てんき', romaji: 'tenki', kr: '날씨' }, { jp: 'くうき', romaji: 'kuuki', kr: '공기' },
            { jp: 'びよういん', romaji: 'biyouin', kr: '미용실' }, { jp: 'びょういん', romaji: 'byouin', kr: '병원' },
            { jp: 'おっと', romaji: 'otto', kr: '남편' }, { jp: 'つま', romaji: 'tsuma', kr: '아내' },
            { jp: 'おと', romaji: 'oto', kr: '소리' }, { jp: 'こえ', romaji: 'koe', kr: '목소리' },
            { jp: 'ざっし', romaji: 'zasshi', kr: '잡지' }, { jp: 'きっぷ', romaji: 'kippu', kr: '표' },
            { jp: 'うんめい', romaji: 'unmei', kr: '운명' }, { jp: 'あんない', romaji: 'annai', kr: '안내' },
            { jp: 'りんご', romaji: 'ringo', kr: '사과' }, { jp: 'でんわ', romaji: 'denwa', kr: '전화' },
            // From notes batch 1
            { jp: 'きん', romaji: 'kin', kr: '금' }, { jp: 'ぎん', romaji: 'gin', kr: '은' },
            { jp: 'じんこう', romaji: 'jinkou', kr: '인구' }, { jp: 'かんじ', romaji: 'kanji', kr: '한자' },
            { jp: 'かじ', romaji: 'kaji', kr: '화재' }, { jp: 'かんばん', romaji: 'kanban', kr: '간판' },
            { jp: 'にほん', romaji: 'nihon', kr: '일본' }, { jp: 'て', romaji: 'te', kr: '손' },
            { jp: 'てん', romaji: 'ten', kr: '점' },
            // From notes batch 2
            { jp: 'むし', romaji: 'mushi', kr: '벌레' }, { jp: 'くち', romaji: 'kuchi', kr: '입' },
            { jp: 'うそ', romaji: 'uso', kr: '거짓말' }, { jp: 'あさ', romaji: 'asa', kr: '아침' },
            { jp: 'ほし', romaji: 'hoshi', kr: '별' }, { jp: 'げんかん', romaji: 'genkan', kr: '현관' },
            { jp: 'かぎ', romaji: 'kagi', kr: '열쇠' }, { jp: 'ぎんこう', romaji: 'ginkou', kr: '은행' },
            { jp: 'じしょ', romaji: 'jisho', kr: '사전' }, { jp: 'しんぶん', romaji: 'shinbun', kr: '신문' },
            { jp: 'ちず', romaji: 'chizu', kr: '지도' }, { jp: 'だいがく', romaji: 'daigaku', kr: '대학교' },
            { jp: 'えんぴつ', romaji: 'enpitsu', kr: '연필' }, { jp: 'とけい', romaji: 'tokei', kr: '시계' },
            { jp: 'げっせき', romaji: 'gesseki', kr: '결석' }, { jp: 'てがみ', romaji: 'tegami', kr: '편지' }
        ];

        const phrases = [
            { jp: 'おはようございます', romaji: 'ohayou gozaimasu', kr: '안녕하세요 (아침 인사)' },
            { jp: 'こんにちは', romaji: 'konnichiwa', kr: '안녕하세요 (점심 인사)' },
            { jp: 'こんばんは', romaji: 'konbanwa', kr: '안녕하세요 (저녁 인사)' },
            { jp: 'さようなら', romaji: 'sayounara', kr: '안녕히 가세요/계세요' },
            { jp: 'じゃ、またね', romaji: 'ja, matane', kr: '그럼, 또 봐 (친한 사이)' },
            { jp: 'また あした', romaji: 'mata ashita', kr: '내일 봐요' },
            { jp: 'バイバイ', romaji: 'baibai', kr: '바이바이' },
            { jp: 'きょうは いい てんきですね', romaji: 'kyou wa ii tenki desu ne', kr: '오늘은 날씨가 좋네요' },
        ];
        
        const mapLocations = [
            { name: '홋카이도 (北海道)', feature: '삿포로(札幌) 눈 축제(雪まつり)가 유명해요.' },
            { name: '혼슈 (本州) - 도쿄 (東京)', feature: '일본의 수도이며, 도쿄 타워(東京タワー)가 상징적이에요.' },
            { name: '혼슈 (本州) - 교토 (京都) & 나라 (奈良)', feature: '전통적인 도시로, 금각사(金閣寺)와 사슴 공원이 유명해요.' },
            { name: '혼슈 (本州) - 오사카 (大阪) & 히메지 (姫路)', feature: '오사카 성(大阪城)과 아름다운 히메지 성(姫路城)이 있어요.' },
            { name: '시코쿠 (四国)', feature: '마츠야마(松山)의 도고 온천(道後温泉)이 유명해요.' },
            { name: '규슈 (九州)', feature: '후쿠오카(福岡), 나가사키(長崎) 등 항구 도시와 온천이 많아요.' },
            { name: '오키나와 (沖縄)', feature: '아름다운 바다와 독특한 류큐(琉球) 문화, 슈리 성(首里城)이 있어요.' },
            { name: '후지산 (富士山)', feature: '일본에서 가장 높고 유명한 산이에요.' }
        ];

        const hiraganaChart = [
            // a, i, u, e, o
            { jp: 'あ', romaji: 'a', kr: '아' }, { jp: 'い', romaji: 'i', kr: '이' }, { jp: 'う', romaji: 'u', kr: '우' }, { jp: 'え', romaji: 'e', kr: '에' }, { jp: 'お', romaji: 'o', kr: '오' },
            // ka, ki, ku, ke, ko
            { jp: 'か', romaji: 'ka', kr: '카' }, { jp: 'き', romaji: 'ki', kr: '키' }, { jp: 'く', romaji: 'ku', kr: '쿠' }, { jp: 'け', romaji: 'ke', kr: '케' }, { jp: 'こ', romaji: 'ko', kr: '코' },
            // sa, shi, su, se, so
            { jp: 'さ', romaji: 'sa', kr: '사' }, { jp: 'し', romaji: 'shi', kr: '시' }, { jp: 'す', romaji: 'su', kr: '스' }, { jp: 'せ', romaji: 'se', kr: '세' }, { jp: 'そ', romaji: 'so', kr: '소' },
            // ta, chi, tsu, te, to
            { jp: 'た', romaji: 'ta', kr: '타' }, { jp: 'ち', romaji: 'chi', kr: '치' }, { jp: 'つ', romaji: 'tsu', kr: '츠' }, { jp: 'て', romaji: 'te', kr: '테' }, { jp: 'と', romaji: 'to', kr: '토' },
            // na, ni, nu, ne, no
            { jp: 'な', romaji: 'na', kr: '나' }, { jp: 'に', romaji: 'ni', kr: '니' }, { jp: 'ぬ', romaji: 'nu', kr: '누' }, { jp: 'ね', romaji: 'ne', kr: '네' }, { jp: 'の', romaji: 'no', kr: '노' },
            // ha, hi, fu, he, ho
            { jp: 'は', romaji: 'ha', kr: '하' }, { jp: 'ひ', romaji: 'hi', kr: '히' }, { jp: 'ふ', romaji: 'fu', kr: '후' }, { jp: 'へ', romaji: 'he', kr: '헤' }, { jp: 'ほ', romaji: 'ho', kr: '호' },
            // ma, mi, mu, me, mo
            { jp: 'ま', romaji: 'ma', kr: '마' }, { jp: 'み', romaji: 'mi', kr: '미' }, { jp: 'む', romaji: 'mu', kr: '무' }, { jp: 'め', romaji: 'me', kr: '메' }, { jp: 'も', romaji: 'mo', kr: '모' },
            // ya, yu, yo
            { jp: 'や', romaji: 'ya', kr: '야' }, { jp: '', romaji: '', kr: '' }, { jp: 'ゆ', romaji: 'yu', kr: '유' }, { jp: '', romaji: '', kr: '' }, { jp: 'よ', romaji: 'yo', kr: '요' },
            // ra, ri, ru, re, ro
            { jp: 'ら', romaji: 'ra', kr: '라' }, { jp: 'り', romaji: 'ri', kr: '리' }, { jp: 'る', romaji: 'ru', kr: '루' }, { jp: 'れ', romaji: 're', kr: '레' }, { jp: 'ろ', romaji: 'ro', kr: '로' },
            // wa, wo
            { jp: 'わ', romaji: 'wa', kr: '와' }, { jp: '', romaji: '', kr: '' }, { jp: '', romaji: '', kr: '' }, { jp: '', romaji: '', kr: '' }, { jp: 'を', romaji: 'wo', kr: '오' },
            // n
            { jp: 'ん', romaji: 'n', kr: '응' }, { jp: '', romaji: '', kr: '' }, { jp: '', romaji: '', kr: '' }, { jp: '', romaji: '', kr: '' }, { jp: '', romaji: '', kr: '' },
        ];
        
        const dakuonCharts = [
            { title: 'か행 → が행 (g)', data: [ { jp: 'が', ro: 'ga'}, { jp: 'ぎ', ro: 'gi'}, { jp: 'ぐ', ro: 'gu'}, { jp: 'げ', ro: 'ge'}, { jp: 'ご', ro: 'go'} ] },
            { title: 'さ행 → ざ행 (z)', data: [ { jp: 'ざ', ro: 'za'}, { jp: 'じ', ro: 'ji'}, { jp: 'ず', ro: 'zu'}, { jp: 'ぜ', ro: 'ze'}, { jp: 'ぞ', ro: 'zo'} ] },
            { title: 'た행 → だ행 (d)', data: [ { jp: 'だ', ro: 'da'}, { jp: 'ぢ', ro: 'ji'}, { jp: 'づ', ro: 'zu'}, { jp: 'で', ro: 'de'}, { jp: 'ど', ro: 'do'} ] },
            { title: 'は행 → ば행 (b)', data: [ { jp: 'ば', ro: 'ba'}, { jp: 'び', ro: 'bi'}, { jp: 'ぶ', ro: 'bu'}, { jp: 'べ', ro: 'be'}, { jp: 'ぼ', ro: 'bo'} ] },
            { title: 'は행 → ぱ행 (p)', data: [ { jp: 'ぱ', ro: 'pa'}, { jp: 'ぴ', ro: 'pi'}, { jp: 'ぷ', ro: 'pu'}, { jp: 'ぺ', ro: 'pe'}, { jp: 'ぽ', ro: 'po'} ] }
        ];

        const yoonCharts = [
            {
                title: '청음',
                data: [
                    { jp: 'きゃ', ro: 'kya' }, { jp: 'きゅ', ro: 'kyu' }, { jp: 'きょ', ro: 'kyo' },
                    { jp: 'しゃ', ro: 'sha' }, { jp: 'しゅ', ro: 'shu' }, { jp: 'しょ', ro: 'sho' },
                    { jp: 'ちゃ', ro: 'cha' }, { jp: 'ちゅ', ro: 'chu' }, { jp: 'ちょ', ro: 'cho' },
                    { jp: 'にゃ', ro: 'nya' }, { jp: 'にゅ', ro: 'nyu' }, { jp: 'にょ', ro: 'nyo' },
                    { jp: 'ひゃ', ro: 'hya' }, { jp: 'ひゅ', ro: 'hyu' }, { jp: 'ひょ', ro: 'hyo' },
                    { jp: 'みゃ', ro: 'mya' }, { jp: 'みゅ', ro: 'myu' }, { jp: 'みょ', ro: 'myo' },
                    { jp: 'りゃ', ro: 'rya' }, { jp: 'りゅ', ro: 'ryu' }, { jp: 'りょ', ro: 'ryo' },
                ]
            },
            {
                title: '탁음',
                data: [
                    { jp: 'ぎゃ', ro: 'gya' }, { jp: 'ぎゅ', ro: 'gyu' }, { jp: 'ぎょ', ro: 'gyo' },
                    { jp: 'じゃ', ro: 'ja' }, { jp: 'じゅ', ro: 'ju' }, { jp: 'じょ', ro: 'jo' },
                    { jp: 'びゃ', ro: 'bya' }, { jp: 'びゅ', ro: 'byu' }, { jp: 'びょ', ro: 'byo' },
                ]
            },
            {
                title: '반탁음',
                data: [
                    { jp: 'ぴゃ', ro: 'pya' }, { jp: 'ぴゅ', ro: 'pyu' }, { jp: 'ぴょ', ro: 'pyo' },
                ]
            }
        ];

        const contentQuestions = [
            { question: "가장 일반적이고 공손한 1인칭 대명사는 무엇인가요?", options: ["わたし", "ぼく", "おれ", "わたくし"], answer: "わたし" },
            { question: "주로 남자 후배나 동년배에게 사용하는 호칭은 무엇인가요?", options: ["ちゃん", "くん", "さん", "さま"], answer: "くん" },
            { question: "작은 'っ'가 받침처럼 쓰이는 발음 규칙은 무엇인가요?", options: ["장음", "발음", "촉음", "연탁"], answer: "촉음" },
            { question: "두 단어가 합쳐질 때 뒤 단어의 첫소리가 탁음으로 바뀌는 현상은 무엇인가요?", options: ["연탁 현상", "장음 현상", "촉음 현상", "발음 현상"], answer: "연탁 현상" },
            { question: "조사로 쓰일 때 'は'는 어떻게 발음하나요?", options: ["하 (ha)", "와 (wa)", "에 (e)", "오 (o)"], answer: "와 (wa)" },
            { question: "조사로 쓰일 때 'へ'는 어떻게 발음하나요?", options: ["헤 (he)", "페 (pe)", "에 (e)", "네 (ne)"], answer: "에 (e)" },
            { question: "일본의 수도는 어디인가요?", options: ["오사카", "교토", "삿포로", "도쿄"], answer: "도쿄" },
            { question: "일본의 화폐 단위는 무엇인가요?", options: ["원", "달러", "엔", "위안"], answer: "엔" },
            { question: "일본의 소비세는 몇 %인가요?", options: ["5%", "8%", "10%", "12%"], answer: "10%" },
            { question: "일본에서 가장 높은 산은 무엇인가요?", options: ["한라산", "에베레스트", "후지산", "백두산"], answer: "후지산" },
            { question: "삿포로 눈 축제가 열리는 지역은 어디인가요?", options: ["혼슈", "규슈", "시코쿠", "홋카이도"], answer: "홋카이도" },
            { question: "일본의 행정구역(도도부현)은 총 몇 개인가요?", options: ["42개", "45개", "47개", "50개"], answer: "47개" }
        ];

        // Populate Vocabulary
        const vocabContainer = document.querySelector('#vocab .grid');
        vocabulary.sort((a, b) => a.jp.localeCompare(b.jp, 'ja')).forEach(word => {
            const card = document.createElement('div');
            card.className = 'bg-white p-4 rounded-lg shadow-md hover:shadow-lg hover:-translate-y-1 transition-all duration-300 flex flex-col justify-center items-center text-center';
            card.innerHTML = `
                <p class="text-3xl font-bold text-blue-500">${word.jp}</p>
                <p class="text-sm text-gray-500">${word.romaji}</p>
                <p class="mt-2 text-lg font-semibold text-gray-800">${word.kr}</p>
            `;
            vocabContainer.appendChild(card);
        });

        // Populate Phrases
        const phrasesContainer = document.querySelector('#phrases-greetings');
        phrases.forEach(phrase => {
            const item = document.createElement('div');
            item.className = 'bg-white p-5 rounded-lg shadow-md flex items-center justify-between flex-wrap';
            item.innerHTML = `
                <div class="mb-2 sm:mb-0">
                    <p class="text-xl font-bold text-blue-500">${phrase.jp}</p>
                    <p class="text-md text-gray-500">${phrase.romaji}</p>
                </div>
                <p class="text-lg font-semibold text-right w-full sm:w-auto">${phrase.kr}</p>
            `;
            phrasesContainer.appendChild(item);
        });
        
        // Populate Hiragana Chart
        const hiraganaContainer = document.getElementById('hiragana-grid');
        hiraganaChart.forEach(char => {
            const cell = document.createElement('div');
            if (char.jp) {
                cell.className = 'bg-blue-50 p-3 rounded-lg shadow-sm hover:shadow-md hover:bg-blue-100 transition-all duration-200 flex flex-col justify-center items-center cursor-pointer';
                cell.innerHTML = `
                    <p class="text-3xl font-bold text-blue-600">${char.jp}</p>
                    <p class="text-xs text-gray-500">${char.romaji}</p>
                    <p class="mt-1 text-md font-medium text-gray-700">${char.kr}</p>
                `;
            } else {
                cell.className = 'p-3 rounded-lg'; // Empty cell
            }
            hiraganaContainer.appendChild(cell);
        });

        // Populate Dakuon/Handakuon Chart
        const dakuonContainer = document.getElementById('dakuon-grid');
        dakuonCharts.forEach(chart => {
            const chartWrapper = document.createElement('div');
            const chartTitle = document.createElement('h4');
            chartTitle.className = 'text-lg font-semibold text-gray-700 mb-2';
            chartTitle.textContent = chart.title;

            const grid = document.createElement('div');
            grid.className = 'hiragana-grid-container';

            chart.data.forEach(char => {
                const cell = document.createElement('div');
                cell.className = 'bg-blue-50 p-3 rounded-lg shadow-sm hover:shadow-md hover:bg-blue-100 transition-all duration-200 flex flex-col justify-center items-center cursor-pointer';
                cell.innerHTML = `
                    <p class="text-3xl font-bold text-blue-600">${char.jp}</p>
                    <p class="text-xs text-gray-500">${char.ro}</p>
                `;
                grid.appendChild(cell);
            });
            
            chartWrapper.appendChild(chartTitle);
            chartWrapper.appendChild(grid);
            dakuonContainer.appendChild(chartWrapper);
        });
        
        // Populate Yoon Chart
        const yoonContainer = document.getElementById('yoon-grid');
        yoonCharts.forEach(chart => {
            const chartWrapper = document.createElement('div');
            const chartTitle = document.createElement('h4');
            chartTitle.className = 'text-lg font-semibold text-gray-700 mb-2';
            chartTitle.textContent = chart.title;
            
            const grid = document.createElement('div');
            grid.className = 'yoon-grid-container';

            chart.data.forEach(char => {
                const cell = document.createElement('div');
                cell.className = 'bg-blue-50 p-2 rounded-lg shadow-sm hover:shadow-md hover:bg-blue-100 transition-all duration-200 flex flex-col justify-center items-center cursor-pointer';
                cell.innerHTML = `
                    <p class="text-2xl font-bold text-blue-600">${char.jp}</p>
                    <p class="text-xs text-gray-500">${char.ro}</p>
                `;
                grid.appendChild(cell);
            });
            
            chartWrapper.appendChild(chartTitle);
            chartWrapper.appendChild(grid);
            yoonContainer.appendChild(chartWrapper);
        });

        // Populate Map Locations
        const mapContainer = document.getElementById('map-locations');
        mapLocations.forEach(loc => {
            const li = document.createElement('li');
            li.className = 'flex items-start';
            li.innerHTML = `
                <span class="text-blue-500 mr-2 pt-1">📍</span>
                <span><strong>${loc.name}:</strong> ${loc.feature}</span>
            `;
            mapContainer.appendChild(li);
        });

        function changeTab(tabName) {
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.classList.remove('active');
            });
            document.querySelector(`.tab-btn[onclick="changeTab('${tabName}')"]`).classList.add('active');

            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'test') {
                showTestSelection();
            }
        }

        // Number Converter Function (Extended to 1-999)
        function convertNumber() {
            const input = parseInt(document.getElementById('number-input').value);
            const resultEl = document.getElementById('number-result');

            if (isNaN(input) || input < 1 || input > 999) {
                resultEl.textContent = '1부터 999까지의 숫자를 입력해주세요.';
                return;
            }

            const units = {
                1: { hiragana: 'いち', romaji: 'ichi', kr: '이찌' },
                2: { hiragana: 'に', romaji: 'ni', kr: '니' },
                3: { hiragana: 'さん', romaji: 'san', kr: '상' },
                4: { hiragana: 'よん', romaji: 'yon', kr: '용' }, // Prefer yon/shi variants as per data
                5: { hiragana: 'ご', romaji: 'go', kr: '고' },
                6: { hiragana: 'ろく', romaji: 'roku', kr: '로꾸' },
                7: { hiragana: 'なな', romaji: 'nana', kr: '나나' }, // Prefer nana/shichi
                8: { hiragana: 'はち', romaji: 'hachi', kr: '하찌' },
                9: { hiragana: 'きゅう', romaji: 'kyuu', kr: '큐-' },
                0: { hiragana: '', romaji: '', kr: '' }
            };

            const tens = {
                1: { hiragana: 'じゅう', romaji: 'juu', kr: '쥬-' },
                2: { hiragana: 'にじゅう', romaji: 'nijuu', kr: '니쥬-' },
                3: { hiragana: 'さんじゅう', romaji: 'sanjuu', kr: '산쥬-' },
                4: { hiragana: 'よんじゅう', romaji: 'yonjuu', kr: '욘쥬-' },
                5: { hiragana: 'ごじゅう', romaji: 'gojuu', kr: '고쥬-' },
                6: { hiragana: 'ろくじゅう', romaji: 'rokujuu', kr: '로꾸쥬-' },
                7: { hiragana: 'ななじゅう', romaji: 'nanajuu', kr: '나나쥬-' },
                8: { hiragana: 'はちじゅう', romaji: 'hachijuu', kr: '하찌쥬-' },
                9: { hiragana: 'きゅうじゅう', romaji: 'kyuujuu', kr: '큐-쥬-' },
                0: { hiragana: '', romaji: '', kr: '' }
            };

            const hundreds = {
                1: { hiragana: 'ひゃく', romaji: 'hyaku', kr: '햐꾸' },
                2: { hiragana: 'にひゃく', romaji: 'nihyaku', kr: '니햐꾸' },
                3: { hiragana: 'さんびゃく', romaji: 'sanbyaku', kr: '산뵤꾸' }, // Special: byaku
                4: { hiragana: 'よんひゃく', romaji: 'yonhyaku', kr: '욘햐꾸' },
                5: { hiragana: 'ごひゃく', romaji: 'gohyaku', kr: '고햐꾸' },
                6: { hiragana: 'ろっぴゃく', romaji: 'roppyaku', kr: '로뽀꾸' }, // Special: ppyaku
                7: { hiragana: 'ななひゃく', romaji: 'nanahyaku', kr: '나나햐꾸' },
                8: { hiragana: 'はっぴゃく', romaji: 'happyaku', kr: '하뽀꾸' }, // Special: ppyaku
                9: { hiragana: 'きゅうひゃく', romaji: 'kyuu hyaku', kr: '큐-햐꾸' },
                0: { hiragana: '', romaji: '', kr: '' }
            };

            let hiraganaStr = '';
            let romajiStr = '';
            let krStr = '';

            const num = input.toString().padStart(3, '0');
            const h = parseInt(num[0]);
            const t = parseInt(num[1]);
            const u = parseInt(num[2]);

            // Hundreds
            if (h > 0) {
                hiraganaStr += hundreds[h].hiragana;
                romajiStr += hundreds[h].romaji;
                krStr += hundreds[h].kr;
            }

            // Tens
            if (t > 0) {
                if (h > 0) {
                    hiraganaStr += '';
                    romajiStr += ' ';
                    krStr += ' ';
                }
                hiraganaStr += tens[t].hiragana;
                romajiStr += tens[t].romaji;
                krStr += tens[t].kr;
            }

            // Units
            if (u > 0) {
                if (h > 0 || t > 0) {
                    hiraganaStr += '';
                    romajiStr += '';
                    krStr += '';
                }
                hiraganaStr += units[u].hiragana;
                romajiStr += units[u].romaji;
                krStr += units[u].kr;
            }

            // For numbers <10, direct unit
            if (input < 10) {
                hiraganaStr = units[input].hiragana;
                romajiStr = units[input].romaji;
                krStr = units[input].kr;
            }

            // Special cases for 4,7,9 in units/tens if needed, but using preferred from data
            resultEl.innerHTML = `<strong>히라가나:</strong> ${hiraganaStr}<br><strong>로마지:</strong> ${romajiStr}<br><strong>한국어:</strong> ${krStr}`;
        }

        // --- Test Feature Logic ---

        const testSelectionEl = document.getElementById('test-selection');
        const quizContainerEl = document.getElementById('quiz-container');
        const resultContainerEl = document.getElementById('result-container');
        const nextQuestionBtn = document.getElementById('next-question-btn');
        const retryBtn = document.getElementById('retry-btn');
        const quizTitleEl = document.getElementById('quiz-title');

        let currentTestType = '';
        let score = 0;
        let currentQuestionIndex = 0;
        let questions = [];
        const QUIZ_LENGTH = 10;

        // Fisher-Yates shuffle
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function generateHiraganaQuestions() {
            const validChars = hiraganaChart.filter(c => c.jp);
            const shuffled = shuffleArray([...validChars]);
            const selected = shuffled.slice(0, QUIZ_LENGTH);
            
            return selected.map(q => {
                const incorrectOptions = shuffleArray(validChars.filter(c => c.jp !== q.jp))
                                            .slice(0, 3)
                                            .map(c => c.romaji);
                return {
                    question: q.jp,
                    answer: q.romaji,
                    options: shuffleArray([q.romaji, ...incorrectOptions])
                };
            });
        }

        function generateVocabQuestions() {
            const shuffled = shuffleArray([...vocabulary]);
            const selected = shuffled.slice(0, QUIZ_LENGTH);

            return selected.map(q => {
                const isJpToKr = Math.random() > 0.5;
                const question = isJpToKr ? q.jp : q.kr;
                const answer = isJpToKr ? q.kr : q.jp;

                const incorrectOptions = shuffleArray(vocabulary.filter(v => v.jp !== q.jp))
                                            .slice(0, 3)
                                            .map(v => isJpToKr ? v.kr : v.jp);

                return {
                    question,
                    answer,
                    options: shuffleArray([answer, ...incorrectOptions])
                };
            });
        }

        function generateContentQuestions() {
            return shuffleArray([...contentQuestions]).slice(0, QUIZ_LENGTH);
        }

        function startTest(type) {
            currentTestType = type;
            score = 0;
            currentQuestionIndex = 0;

            if (type === 'hiragana') {
                questions = generateHiraganaQuestions();
                quizTitleEl.textContent = '히라가나 테스트';
            } else if (type === 'vocab') {
                questions = generateVocabQuestions();
                quizTitleEl.textContent = '단어 테스트';
            } else if (type === 'content') {
                questions = generateContentQuestions();
                quizTitleEl.textContent = '학습 내용 테스트';
            }

            testSelectionEl.classList.add('hidden');
            resultContainerEl.classList.add('hidden');
            quizContainerEl.classList.remove('hidden');

            displayQuestion();
        }

        function displayQuestion() {
            if (currentQuestionIndex >= questions.length) {
                showResults();
                return;
            }

            const q = questions[currentQuestionIndex];
            const progressEl = document.getElementById('quiz-progress');
            const questionEl = document.getElementById('quiz-question');
            const optionsEl = document.getElementById('quiz-options');
            const feedbackEl = document.getElementById('quiz-feedback');

            progressEl.textContent = `문제 ${currentQuestionIndex + 1} / ${questions.length}`;
            questionEl.textContent = q.question;
            optionsEl.innerHTML = '';
            feedbackEl.textContent = '';
            nextQuestionBtn.classList.add('hidden');

            q.options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.className = 'quiz-option p-4 border-2 rounded-lg text-lg hover:bg-gray-100 transition-colors';
                button.onclick = () => checkAnswer(button, option);
                optionsEl.appendChild(button);
            });
        }
        
        function checkAnswer(button, selectedOption) {
            const q = questions[currentQuestionIndex];
            const isCorrect = selectedOption === q.answer;
            const feedbackEl = document.getElementById('quiz-feedback');
            const optionsEl = document.getElementById('quiz-options');

            if (isCorrect) {
                score++;
                button.classList.add('correct');
                feedbackEl.textContent = '정답입니다! 🎉';
                feedbackEl.className = 'mt-4 text-center font-bold text-green-500';
            } else {
                button.classList.add('incorrect');
                feedbackEl.textContent = `오답입니다. 정답은 '${q.answer}' 입니다.`;
                feedbackEl.className = 'mt-4 text-center font-bold text-red-500';
            }

            // Disable all option buttons
            Array.from(optionsEl.children).forEach(btn => {
                btn.disabled = true;
                // Show correct answer if wrong one was picked
                if (!isCorrect && btn.textContent === q.answer) {
                    btn.classList.add('correct');
                }
            });

            nextQuestionBtn.classList.remove('hidden');
        }

        nextQuestionBtn.addEventListener('click', () => {
            currentQuestionIndex++;
            displayQuestion();
        });

        function showResults() {
            quizContainerEl.classList.add('hidden');
            resultContainerEl.classList.remove('hidden');
            
            const scoreEl = document.getElementById('result-score');
            const messageEl = document.getElementById('result-message');

            scoreEl.textContent = `${score} / ${questions.length}`;
            
            let message = '';
            const percentage = (score / questions.length) * 100;
            if (percentage === 100) {
                message = '완벽해요! 대단합니다! 💯';
            } else if (percentage >= 70) {
                message = '훌륭해요! 정말 잘하셨어요. 👍';
            } else if (percentage >= 50) {
                message = '좋아요! 조금만 더 복습해볼까요?';
            } else {
                message = '괜찮아요! 다시 한번 도전해보세요. 😊';
            }
            messageEl.textContent = message;
        }

        retryBtn.addEventListener('click', () => startTest(currentTestType));

        function showTestSelection() {
            resultContainerEl.classList.add('hidden');
            quizContainerEl.classList.add('hidden');
            testSelectionEl.classList.remove('hidden');
        }
    </script>
</body>
</html>
